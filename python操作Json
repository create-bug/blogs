åŸæ–‡http://www.cnblogs.com/coser/archive/2011/12/14/2287739.html

ä»€ä¹ˆæ˜¯jsonï¼š

JSON(JavaScript Object Notation) æ˜¯ä¸€ç§è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼ã€‚æ˜“äºäººé˜…è¯»å’Œç¼–å†™ã€‚åŒæ—¶ä¹Ÿæ˜“äºæœºå™¨è§£æå’Œç”Ÿæˆã€‚å®ƒåŸºäºJavaScript Programming Language, Standard ECMA-262 3rd Edition â€“ December 1999çš„ä¸€ä¸ªå­é›†ã€‚JSONé‡‡ç”¨å®Œå…¨ç‹¬ç«‹äºè¯­è¨€çš„æ–‡æœ¬æ ¼å¼ï¼Œä½†æ˜¯ä¹Ÿä½¿ç”¨äº†ç±»ä¼¼äºCè¯­è¨€å®¶æ—çš„ä¹ æƒ¯ï¼ˆåŒ…æ‹¬C, C++, C#, Java, JavaScript, Perl, Pythonç­‰ï¼‰ã€‚è¿™äº›ç‰¹æ€§ä½¿JSONæˆä¸ºç†æƒ³çš„æ•°æ®äº¤æ¢è¯­è¨€ã€‚

JSONå»ºæ„äºä¸¤ç§ç»“æ„ï¼š

â€œåç§°/å€¼â€å¯¹çš„é›†åˆï¼ˆA collection of name/value pairsï¼‰ã€‚ä¸åŒçš„è¯­è¨€ä¸­ï¼Œå®ƒè¢«ç†è§£ä¸ºå¯¹è±¡ï¼ˆobjectï¼‰ï¼Œçºªå½•ï¼ˆrecordï¼‰ï¼Œç»“æ„ï¼ˆstructï¼‰ï¼Œå­—å…¸ï¼ˆdictionaryï¼‰ï¼Œå“ˆå¸Œè¡¨ï¼ˆhash tableï¼‰ï¼Œæœ‰é”®åˆ—è¡¨ï¼ˆkeyed listï¼‰ï¼Œæˆ–è€…å…³è”æ•°ç»„ ï¼ˆassociative arrayï¼‰ã€‚
å€¼çš„æœ‰åºåˆ—è¡¨ï¼ˆAn ordered list of valuesï¼‰ã€‚åœ¨å¤§éƒ¨åˆ†è¯­è¨€ä¸­ï¼Œå®ƒè¢«ç†è§£ä¸ºæ•°ç»„ï¼ˆarrayï¼‰ã€‚
è¿™äº›éƒ½æ˜¯å¸¸è§çš„æ•°æ®ç»“æ„ã€‚äº‹å®ä¸Šå¤§éƒ¨åˆ†ç°ä»£è®¡ç®—æœºè¯­è¨€éƒ½ä»¥æŸç§å½¢å¼æ”¯æŒå®ƒä»¬ã€‚è¿™ä½¿å¾—ä¸€ç§æ•°æ®æ ¼å¼åœ¨åŒæ ·åŸºäºè¿™äº›ç»“æ„çš„ç¼–ç¨‹è¯­è¨€ä¹‹é—´äº¤æ¢æˆä¸ºå¯èƒ½ã€‚

jsoå®˜æ–¹è¯´æ˜å‚è§ï¼šhttp://json.org/

Pythonæ“ä½œjsonçš„æ ‡å‡†apiåº“å‚è€ƒï¼šhttp://docs.python.org/library/json.html

å¯¹ç®€å•æ•°æ®ç±»å‹çš„encoding å’Œ decodingï¼š

ä½¿ç”¨ç®€å•çš„json.dumpsæ–¹æ³•å¯¹ç®€å•æ•°æ®ç±»å‹è¿›è¡Œç¼–ç ï¼Œä¾‹å¦‚ï¼š

1
2
3
4
5
6
import json
obj = [[1,2,3],123,123.123,'abc',{'key1'ğŸ˜¦1,2,3),'key2'ğŸ˜¦4,5,6)}]
encodedjson = json.dumps(obj)
print repr(obj)
print encodedjson
è¾“å‡ºï¼š

[[1, 2, 3], 123, 123.123, â€˜abcâ€™, {â€˜key2â€™: (4, 5, 6), â€˜key1â€™: (1, 2, 3)}]
[[1, 2, 3], 123, 123.123, â€œabcâ€, {â€œkey2â€: [4, 5, 6], â€œkey1â€: [1, 2, 3]}]

é€šè¿‡è¾“å‡ºçš„ç»“æœå¯ä»¥çœ‹å‡ºï¼Œç®€å•ç±»å‹é€šè¿‡encodeä¹‹åè·Ÿå…¶åŸå§‹çš„repr()è¾“å‡ºç»“æœéå¸¸ç›¸ä¼¼ï¼Œä½†æ˜¯æœ‰äº›æ•°æ®ç±»å‹è¿›è¡Œäº†æ”¹å˜ï¼Œä¾‹å¦‚ä¸Šä¾‹ä¸­çš„å…ƒç»„åˆ™è½¬æ¢ä¸ºäº†åˆ—è¡¨ã€‚åœ¨jsonçš„ç¼–ç è¿‡ç¨‹ä¸­ï¼Œä¼šå­˜åœ¨ä»pythonåŸå§‹ç±»å‹å‘jsonç±»å‹çš„è½¬åŒ–è¿‡ç¨‹ï¼Œå…·ä½“çš„è½¬åŒ–å¯¹ç…§å¦‚ä¸‹ï¼š

image

json.dumps()æ–¹æ³•è¿”å›äº†ä¸€ä¸ªstrå¯¹è±¡encodedjsonï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥åœ¨å¯¹encodedjsonè¿›è¡Œdecodeï¼Œå¾—åˆ°åŸå§‹æ•°æ®ï¼Œéœ€è¦ä½¿ç”¨çš„json.loads()å‡½æ•°ï¼š

1
2
3
4
decodejson = json.loads(encodedjson)
print type(decodejson)
print decodejson[4]['key1']
print decodejson
è¾“å‡ºï¼š

<type â€˜listâ€™>
[1, 2, 3]

[[1, 2, 3], 123, 123.123, uâ€™abcâ€™, {uâ€™key2â€²: [4, 5, 6], uâ€™key1â€²: [1, 2, 3]}]

loadsæ–¹æ³•è¿”å›äº†åŸå§‹çš„å¯¹è±¡ï¼Œä½†æ˜¯ä»ç„¶å‘ç”Ÿäº†ä¸€äº›æ•°æ®ç±»å‹çš„è½¬åŒ–ã€‚æ¯”å¦‚ï¼Œä¸Šä¾‹ä¸­â€˜abcâ€™è½¬åŒ–ä¸ºäº†unicodeç±»å‹ã€‚ä»jsonåˆ°pythonçš„ç±»å‹è½¬åŒ–å¯¹ç…§å¦‚ä¸‹ï¼š

image

json.dumpsæ–¹æ³•æä¾›äº†å¾ˆå¤šå¥½ç”¨çš„å‚æ•°å¯ä¾›é€‰æ‹©ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„æœ‰sort_keysï¼ˆå¯¹dictå¯¹è±¡è¿›è¡Œæ’åºï¼Œæˆ‘ä»¬çŸ¥é“é»˜è®¤dictæ˜¯æ— åºå­˜æ”¾çš„ï¼‰ï¼Œseparatorsï¼Œindentç­‰å‚æ•°ã€‚

æ’åºåŠŸèƒ½ä½¿å¾—å­˜å‚¨çš„æ•°æ®æ›´åŠ æœ‰åˆ©äºè§‚å¯Ÿï¼Œä¹Ÿä½¿å¾—å¯¹jsonè¾“å‡ºçš„å¯¹è±¡è¿›è¡Œæ¯”è¾ƒï¼Œä¾‹å¦‚ï¼š

1
2
3
4
5
6
7
8
9
10
data1 = {'b':789,'c':456,'a':123}
data2 = {'a':123,'b':789,'c':456}
d1 = json.dumps(data1,sort_keys=True)
d2 = json.dumps(data2)
d3 = json.dumps(data2,sort_keys=True)
print d1
print d2
print d3
print d1==d2
print d1==d3
è¾“å‡ºï¼š

{â€œaâ€: 123, â€œbâ€: 789, â€œcâ€: 456}
{â€œaâ€: 123, â€œcâ€: 456, â€œbâ€: 789}
{â€œaâ€: 123, â€œbâ€: 789, â€œcâ€: 456}
False
True

ä¸Šä¾‹ä¸­ï¼Œæœ¬æ¥data1å’Œdata2æ•°æ®åº”è¯¥æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ç”±äºdictå­˜å‚¨çš„æ— åºç‰¹æ€§ï¼Œé€ æˆä¸¤è€…æ— æ³•æ¯”è¾ƒã€‚å› æ­¤ä¸¤è€…å¯ä»¥é€šè¿‡æ’åºåçš„ç»“æœè¿›è¡Œå­˜å‚¨å°±é¿å…äº†æ•°æ®æ¯”è¾ƒä¸ä¸€è‡´çš„æƒ…å†µå‘ç”Ÿï¼Œä½†æ˜¯æ’åºåå†è¿›è¡Œå­˜å‚¨ï¼Œç³»ç»Ÿå¿…å®šè¦å¤šåšä¸€äº›äº‹æƒ…ï¼Œä¹Ÿä¸€å®šä¼šå› æ­¤é€ æˆä¸€å®šçš„æ€§èƒ½æ¶ˆè€—ï¼Œæ‰€ä»¥é€‚å½“æ’åºæ˜¯å¾ˆé‡è¦çš„ã€‚

indentå‚æ•°æ˜¯ç¼©è¿›çš„æ„æ€ï¼Œå®ƒå¯ä»¥ä½¿å¾—æ•°æ®å­˜å‚¨çš„æ ¼å¼å˜å¾—æ›´åŠ ä¼˜é›…ã€‚

1
2
3
data1 = {'b':789,'c':456,'a':123}
d1 = json.dumps(data1,sort_keys=True,indent=4)
print d1
è¾“å‡ºï¼š

{
â€œaâ€: 123,
â€œbâ€: 789,
â€œcâ€: 456
}

è¾“å‡ºçš„æ•°æ®è¢«æ ¼å¼åŒ–ä¹‹åï¼Œå˜å¾—å¯è¯»æ€§æ›´å¼ºï¼Œä½†æ˜¯å´æ˜¯é€šè¿‡å¢åŠ ä¸€äº›å†—ä½™çš„ç©ºç™½æ ¼æ¥è¿›è¡Œå¡«å……çš„ã€‚jsonä¸»è¦æ˜¯ä½œä¸ºä¸€ç§æ•°æ®é€šä¿¡çš„æ ¼å¼å­˜åœ¨çš„ï¼Œè€Œç½‘ç»œé€šä¿¡æ˜¯å¾ˆåœ¨ä¹æ•°æ®çš„å¤§å°çš„ï¼Œæ— ç”¨çš„ç©ºæ ¼ä¼šå æ®å¾ˆå¤šé€šä¿¡å¸¦å®½ï¼Œæ‰€ä»¥é€‚å½“æ—¶å€™ä¹Ÿè¦å¯¹æ•°æ®è¿›è¡Œå‹ç¼©ã€‚separatorå‚æ•°å¯ä»¥èµ·åˆ°è¿™æ ·çš„ä½œç”¨ï¼Œè¯¥å‚æ•°ä¼ é€’æ˜¯ä¸€ä¸ªå…ƒç»„ï¼ŒåŒ…å«åˆ†å‰²å¯¹è±¡çš„å­—ç¬¦ä¸²ã€‚

1
2
3
4
5
print 'DATA:', repr(data)
print 'repr(data)             :', len(repr(data))
print 'dumps(data)            :', len(json.dumps(data))
print 'dumps(data, indent=2)  :', len(json.dumps(data, indent=4))
print 'dumps(data, separators):', len(json.dumps(data, separators=(',',':')))
è¾“å‡ºï¼š

DATA: {â€˜aâ€™: 123, â€˜câ€™: 456, â€˜bâ€™: 789}
repr(data)             : 30
dumps(data)            : 30
dumps(data, indent=2)  : 46
dumps(data, separators): 25

é€šè¿‡ç§»é™¤å¤šä½™çš„ç©ºç™½ç¬¦ï¼Œè¾¾åˆ°äº†å‹ç¼©æ•°æ®çš„ç›®çš„ï¼Œè€Œä¸”æ•ˆæœè¿˜æ˜¯æ¯”è¾ƒæ˜æ˜¾çš„ã€‚

å¦ä¸€ä¸ªæ¯”è¾ƒæœ‰ç”¨çš„dumpså‚æ•°æ˜¯skipkeysï¼Œé»˜è®¤ä¸ºFalseã€‚ dumpsæ–¹æ³•å­˜å‚¨dictå¯¹è±¡æ—¶ï¼Œkeyå¿…é¡»æ˜¯strç±»å‹ï¼Œå¦‚æœå‡ºç°äº†å…¶ä»–ç±»å‹çš„è¯ï¼Œé‚£ä¹ˆä¼šäº§ç”ŸTypeErrorå¼‚å¸¸ï¼Œå¦‚æœå¼€å¯è¯¥å‚æ•°ï¼Œè®¾ä¸ºTrueçš„è¯ï¼Œåˆ™ä¼šæ¯”è¾ƒä¼˜é›…çš„è¿‡åº¦ã€‚

1
2
data = {'b':789,'c':456,(1,2):123}
print json.dumps(data,skipkeys=True)
è¾“å‡ºï¼š

{â€œcâ€: 456, â€œbâ€: 789}

 

å¤„ç†è‡ªå·±çš„æ•°æ®ç±»å‹

jsonæ¨¡å—ä¸ä»…å¯ä»¥å¤„ç†æ™®é€šçš„pythonå†…ç½®ç±»å‹ï¼Œä¹Ÿå¯ä»¥å¤„ç†æˆ‘ä»¬è‡ªå®šä¹‰çš„æ•°æ®ç±»å‹ï¼Œè€Œå¾€å¾€å¤„ç†è‡ªå®šä¹‰çš„å¯¹è±¡æ˜¯å¾ˆå¸¸ç”¨çš„ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç±»Personã€‚

1
2
3
4
5
6
7
8
9
class Person(object):
    def __init__(self,name,age):
        self.name = name
        self.age = age
    def __repr__(self):
        return 'Person Object name : %s , age : %d' % (self.name,self.age)
if __name__  == '__main__':
    p = Person('Peter',22)
    print p
å¦‚æœç›´æ¥é€šè¿‡json.dumpsæ–¹æ³•å¯¹Personçš„å®ä¾‹è¿›è¡Œå¤„ç†çš„è¯ï¼Œä¼šæŠ¥é”™ï¼Œå› ä¸ºjsonæ— æ³•æ”¯æŒè¿™æ ·çš„è‡ªåŠ¨è½¬åŒ–ã€‚é€šè¿‡ä¸Šé¢æ‰€æåˆ°çš„jsonå’Œpythonçš„ç±»å‹è½¬åŒ–å¯¹ç…§è¡¨ï¼Œå¯ä»¥å‘ç°ï¼Œobjectç±»å‹æ˜¯å’Œdictç›¸å…³è”çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠæˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»å‹è½¬åŒ–ä¸ºdictï¼Œç„¶åå†è¿›è¡Œå¤„ç†ã€‚è¿™é‡Œï¼Œæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥ä½¿ç”¨ã€‚

æ–¹æ³•ä¸€ï¼šè‡ªå·±å†™è½¬åŒ–å‡½æ•°

1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
'''
Created on 2011-12-14
@author: Peter
'''
import Person
import json
p = Person.Person('Peter',22)
def object2dict(obj):
    #convert object to a dict
    d = {}
    d['__class__'] = obj.__class__.__name__
    d['__module__'] = obj.__module__
    d.update(obj.__dict__)
    return d
def dict2object(d):
    #convert dict to object
    if'__class__' in d:
        class_name = d.pop('__class__')
        module_name = d.pop('__module__')
        module = __import__(module_name)
        class_ = getattr(module,class_name)
        args = dict((key.encode('ascii'), value) for key, value in d.items()) #get args
        inst = class_(**args) #create new instance
    else:
        inst = d
    return inst
d = object2dict(p)
print d
#{'age': 22, '__module__': 'Person', '__class__': 'Person', 'name': 'Peter'}
o = dict2object(d)
print type(o),o
#<class 'Person.Person'> Person Object name : Peter , age : 22
dump = json.dumps(p,default=object2dict)
print dump
#{"age": 22, "__module__": "Person", "__class__": "Person", "name": "Peter"}
load = json.loads(dump,object_hook = dict2object)
print load
#Person Object name : Peter , age : 22
ä¸Šé¢ä»£ç å·²ç»å†™çš„å¾ˆæ¸…æ¥šäº†ï¼Œå®è´¨å°±æ˜¯è‡ªå®šä¹‰objectç±»å‹å’Œdictç±»å‹è¿›è¡Œè½¬åŒ–ã€‚object2dictå‡½æ•°å°†å¯¹è±¡æ¨¡å—åã€ç±»åä»¥åŠ__dict__å­˜å‚¨åœ¨dictå¯¹è±¡é‡Œï¼Œå¹¶è¿”å›ã€‚dict2objectå‡½æ•°åˆ™æ˜¯åè§£å‡ºæ¨¡å—åã€ç±»åã€å‚æ•°ï¼Œåˆ›å»ºæ–°çš„å¯¹è±¡å¹¶è¿”å›ã€‚åœ¨json.dumps æ–¹æ³•ä¸­å¢åŠ defaultå‚æ•°ï¼Œè¯¥å‚æ•°è¡¨ç¤ºåœ¨è½¬åŒ–è¿‡ç¨‹ä¸­è°ƒç”¨æŒ‡å®šçš„å‡½æ•°ï¼ŒåŒæ ·åœ¨decodeè¿‡ç¨‹ä¸­json.loadsæ–¹æ³•å¢åŠ object_hook,æŒ‡å®šè½¬åŒ–å‡½æ•°ã€‚

æ–¹æ³•äºŒï¼šç»§æ‰¿JSONEncoderå’ŒJSONDecoderç±»ï¼Œè¦†å†™ç›¸å…³æ–¹æ³•

JSONEncoderç±»è´Ÿè´£ç¼–ç ï¼Œä¸»è¦æ˜¯é€šè¿‡å…¶defaultå‡½æ•°è¿›è¡Œè½¬åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥overrideè¯¥æ–¹æ³•ã€‚åŒç†å¯¹äºJSONDecoderã€‚

1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
'''
Created on 2011-12-14
@author: Peter
'''
import Person
import json
p = Person.Person('Peter',22)
class MyEncoder(json.JSONEncoder):
    def default(self,obj):
        #convert object to a dict
        d = {}
        d['__class__'] = obj.__class__.__name__
        d['__module__'] = obj.__module__
        d.update(obj.__dict__)
        return d
class MyDecoder(json.JSONDecoder):
    def __init__(self):
        json.JSONDecoder.__init__(self,object_hook=self.dict2object)
    def dict2object(self,d):
        #convert dict to object
        if'__class__' in d:
            class_name = d.pop('__class__')
            module_name = d.pop('__module__')
            module = __import__(module_name)
            class_ = getattr(module,class_name)
            args = dict((key.encode('ascii'), value) for key, value in d.items()) #get args
            inst = class_(**args) #create new instance
        else:
            inst = d
        return inst
d = MyEncoder().encode(p)
o =  MyDecoder().decode(d)
print d
print type(o), o
 

å¯¹äºJSONDecoderç±»æ–¹æ³•ï¼Œç¨å¾®æœ‰ç‚¹ä¸åŒï¼Œä½†æ˜¯æ”¹å†™èµ·æ¥ä¹Ÿä¸æ˜¯å¾ˆéº»çƒ¦ã€‚çœ‹ä»£ç åº”è¯¥å°±æ¯”è¾ƒæ¸…æ¥šäº†ã€‚

